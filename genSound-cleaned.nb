(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[     13451,        352]
NotebookOptionsPosition[     13065,        332]
NotebookOutlinePosition[     13392,        347]
CellTagsIndexPosition[     13349,        344]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"genSound", "[", " ", "music_", "]"}], ":=", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"soundNoteList", "[", "list_", "]"}], ":=", " ", 
         RowBox[{"Apply", "[", 
          RowBox[{"SoundNote", ",", " ", "list"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"generated", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{"soundNoteList", ",", " ", "music"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sound", " ", "=", " ", 
         RowBox[{"Sound", "[", "generated", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "sound", "]"}], ";"}], "\[IndentingNewLine]", 
       ")"}]}], "\n", 
     RowBox[{
      RowBox[{"ApplyAndJoin", "[", 
       RowBox[{"fn_", ",", " ", "count_"}], "]"}], ":=", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Map", "[", 
         RowBox[{"fn", ",", " ", 
          RowBox[{"Range", "[", "count", "]"}]}], "]"}], "]"}], 
       "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]", "\n", 
     RowBox[{
      RowBox[{"ChooseTone", "[", 
       RowBox[{
       "previous_", ",", "weights_", ",", "toneWeights_", ",", " ", 
        "toneImportance_"}], "]"}], ":=", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"allTones", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"Length", "[", "weights", "]"}]}], ",", 
            RowBox[{"Length", "[", "weights", "]"}]}], "]"}], "+", 
          "previous"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"allIntervalWeights", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Reverse", "[", 
            RowBox[{"Drop", "[", 
             RowBox[{"weights", ",", 
              RowBox[{"-", "1"}]}], "]"}], "]"}], ",", "weights"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"allToneWeights", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"t", ",", 
             RowBox[{"Part", "[", 
              RowBox[{"toneWeights", ",", 
               RowBox[{"t", " ", "%", " ", 
                RowBox[{"Length", "[", "toneWeights", "]"}]}]}], "]"}]}], 
            "]"}], ",", "allTones"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tone", " ", "=", " ", 
         RowBox[{"RandomSample", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"allToneWeights", " ", "*", " ", "allIntervalWeights"}], 
             ")"}], " ", "^", " ", "toneImportance"}], " ", "\[Rule]", " ", 
           "allTones"}]}]}]}]}]}]}], ")"}], "\[IndentingNewLine]"}], 
  ")"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GetMelody", "[", 
    RowBox[{"size_", ",", " ", "weights_", ",", " ", "toneWeights_"}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"melody", " ", "=", " ", 
      RowBox[{"{", "0", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", " ", 
       RowBox[{"i", "<", "size"}], ",", 
       RowBox[{"i", "++"}], ",", " ", 
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"previous", " ", "=", " ", 
          RowBox[{"Part", "[", 
           RowBox[{"melody", ",", " ", "i"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"interval", " ", "=", " ", 
          RowBox[{"RandomSample", "[", 
           RowBox[{
            RowBox[{"weights", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
              "0", ",", " ", "1", ",", " ", "2", ",", "3", ",", " ", "4", ",",
                " ", "5", ",", " ", "6", ",", " ", "7", ",", " ", "8"}], 
              "}"}]}], ",", " ", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"interval", " ", "=", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"RandomReal", "[", "]"}], ">", "0.5"}], ",", " ", 
            "interval", ",", " ", 
            RowBox[{"-", "interval"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"next", " ", "=", " ", 
          RowBox[{"interval", "+", " ", "previous"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"melody", ",", " ", "next"}], "]"}], ";"}], 
        "\[IndentingNewLine]", ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "melody", "]"}], ";"}], "\[IndentingNewLine]", 
    ")"}]}], "\n", "\n"}], "\n", 
 RowBox[{
  RowBox[{"CreateMusic", "[", 
   RowBox[{"melody_", ",", " ", "tones_", ",", " ", "rythm_"}], "]"}], " ", ":=",
   " ", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"music", " ", "=", " ", 
     RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"For", "[", 
     RowBox[{
      RowBox[{"i", "=", "0"}], ",", " ", 
      RowBox[{"i", "<", 
       RowBox[{"Length", "[", "melody", "]"}]}], ",", 
      RowBox[{"i", "++"}], ",", " ", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"toneOffset", " ", "=", " ", 
         RowBox[{"Part", "[", 
          RowBox[{"melody", ",", " ", 
           RowBox[{"i", "+", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tone", " ", "=", " ", 
         RowBox[{
          RowBox[{"Part", "[", 
           RowBox[{"tones", ",", " ", 
            RowBox[{"1", " ", "+", " ", 
             RowBox[{"Mod", "[", 
              RowBox[{"toneOffset", ",", " ", 
               RowBox[{"Length", "[", "tones", "]"}]}], "]"}]}]}], "]"}], " ",
           "+", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Floor", "[", 
             RowBox[{"toneOffset", " ", "/", " ", 
              RowBox[{"Length", "[", "tones", "]"}]}], "]"}], " ", "*", " ", 
            "12"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sound", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{"tone", ",", " ", 
           RowBox[{
            RowBox[{"Part", "[", 
             RowBox[{"rythm", ",", " ", 
              RowBox[{"i", " ", "+", " ", "1"}]}], "]"}], " ", "*", " ", 
            "1.5"}], ",", " ", "\"\<Piano\>\""}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"music", ",", "sound"}], "]"}], ";"}], "\[IndentingNewLine]",
        ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", "music", "]"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GetTact", "[", 
    RowBox[{"divCoef_", ",", " ", "recursionCoef_"}], "]"}], " ", ":=", " ", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"RandomReal", "[", "]"}], " ", ">", " ", "divCoef"}], ",", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", "1", "}"}], "]"}], "\[IndentingNewLine]", ")"}], ",", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"divLen", "[", "e_", "]"}], " ", ":=", " ", 
         RowBox[{"e", " ", "/", " ", "2"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", " ", 
         RowBox[{"Map", "[", 
          RowBox[{"divLen", ",", " ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"GetTact", "[", 
              RowBox[{
               RowBox[{"divCoef", " ", "/", " ", "recursionCoef"}], ",", " ", 
               "recursionCoef"}], "]"}], ",", " ", 
             RowBox[{"GetTact", "[", 
              RowBox[{
               RowBox[{"divCoef", "/", "recursionCoef"}], ",", " ", 
               "recursionCoef"}], "]"}]}], "]"}]}], "]"}], "]"}], ";"}], 
       "\[IndentingNewLine]", ")"}]}], "]"}], "\[IndentingNewLine]", ")"}]}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GetRythm", "[", 
    RowBox[{"divCoef_", ",", " ", "recursionCoef_", ",", " ", "size_"}], 
    "]"}], " ", ":=", " ", "\[IndentingNewLine]", 
   RowBox[{"ApplyAndJoin", "[", 
    RowBox[{
     RowBox[{"Function", "[", 
      RowBox[{"i", ",", " ", 
       RowBox[{"GetTact", "[", 
        RowBox[{"divCoef", ",", " ", "recursionCoef"}], "]"}]}], "]"}], ",", 
     " ", "size"}], "]"}]}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"rtm1", " ", "=", " ", 
   RowBox[{"GetRythm", "[", 
    RowBox[{"2.3", ",", " ", "3", ",", "  ", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rtm2", " ", "=", " ", 
   RowBox[{"GetRythm", "[", 
    RowBox[{"2.3", ",", " ", "3", ",", "  ", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tones", " ", "=", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0", ",", " ", "2", ",", " ", "3", ",", " ", "5", ",", " ", "7", ",", 
      " ", "8", ",", " ", "10"}], "}"}], " ", "+", " ", "0"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"weights", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "1", ",", " ", "3", ",", " ", "5", ",", " ", "4", ",", " ", "4", ",", " ",
      "0.7", ",", "0.7", ",", " ", "1.2", ",", " ", "1"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mainM", " ", "=", " ", 
   RowBox[{"GetMelody", "[", 
    RowBox[{"Length", "[", "rtm", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"melody1", " ", "=", " ", 
  RowBox[{"Join", "[", 
   RowBox[{
    RowBox[{"GetMelody", "[", 
     RowBox[{
      RowBox[{"Length", "[", "rtm1", "]"}], ",", " ", "weights"}], "]"}], ",",
     " ", 
    RowBox[{"ReplacePart", "[", 
     RowBox[{"mainM", ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", "rtm2", "]"}], "\[Rule]", " ", "4"}]}], "]"}], 
    ",", " ", 
    RowBox[{"GetMelody", "[", 
     RowBox[{
      RowBox[{"Length", "[", "rtm1", "]"}], ",", " ", "weights"}], "]"}], ",",
     " ", 
    RowBox[{"ReplacePart", "[", 
     RowBox[{"mainM", ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", "rtm2", "]"}], "\[Rule]", "0"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mainM", " ", "=", " ", 
   RowBox[{"GetMelody", "[", 
    RowBox[{"Length", "[", "rtm", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"melody2", " ", "=", " ", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"GetMelody", "[", 
      RowBox[{
       RowBox[{"Length", "[", "rtm2", "]"}], ",", " ", "weights"}], "]"}], 
     ",", " ", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{"mainM", ",", " ", 
       RowBox[{
        RowBox[{"Length", "[", "rtm1", "]"}], "\[Rule]", " ", "4"}]}], "]"}], 
     ",", " ", 
     RowBox[{"GetMelody", "[", 
      RowBox[{
       RowBox[{"Length", "[", "rtm2", "]"}], ",", " ", "weights"}], "]"}], 
     ",", " ", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{"mainM", ",", " ", 
       RowBox[{
        RowBox[{"Length", "[", "rtm1", "]"}], "\[Rule]", "0"}]}], "]"}]}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"genSound", "[", 
  RowBox[{"CreateMusic", "[", 
   RowBox[{
    RowBox[{"Join", "[", 
     RowBox[{"melody1", ",", " ", "melody2", ",", " ", 
      RowBox[{"melody1", "+", "3"}], ",", " ", 
      RowBox[{"melody2", "-", "4"}]}], "]"}], ",", "tones", ",", 
    RowBox[{"ApplyAndJoin", "[", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{"i", ",", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
         "rtm1", ",", " ", "rtm2", ",", " ", "rtm1", ",", " ", "rtm2", ",", 
          " ", "rtm2", ",", " ", "rtm1", ",", " ", "rtm2", ",", " ", "rtm1"}],
          "]"}]}], "]"}], ",", " ", "2"}], "]"}]}], "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.684046514851108*^9, 3.684046519931779*^9}, {
   3.684046645958846*^9, 3.684046672678063*^9}, {3.684046708974457*^9, 
   3.684046843623981*^9}, {3.6840470143046303`*^9, 3.684047029467244*^9}, {
   3.6840473015291653`*^9, 3.684047373231291*^9}, {3.6840475550018463`*^9, 
   3.684047560456291*^9}, {3.684047646591329*^9, 3.684047659678829*^9}, {
   3.684047755748856*^9, 3.684047777445161*^9}, {3.6840478666902523`*^9, 
   3.684047870069398*^9}, {3.6840479534641743`*^9, 3.6840479920608387`*^9}, {
   3.684048311510783*^9, 3.684048369940363*^9}, {3.684048448697501*^9, 
   3.684048503995116*^9}, {3.684048560206251*^9, 3.6840485675304003`*^9}, {
   3.684050369276421*^9, 3.684050371070743*^9}, {3.685632775602785*^9, 
   3.685632777170759*^9}, 3.6857125280378428`*^9, 3.685712586711673*^9, {
   3.685712624423588*^9, 3.685712645749468*^9}}]
},
WindowSize->{1920, 1025},
WindowMargins->{{0, Automatic}, {0, 20}},
FrontEndVersion->"11.0 for Linux x86 (64-bit) (July 28, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[400, 13, 12661, 317, 1248, "Input"]
}
]
*)

