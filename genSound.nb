(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     13011,        344]
NotebookOptionsPosition[     12777,        331]
NotebookOutlinePosition[     13110,        346]
CellTagsIndexPosition[     13067,        343]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"genSound", "[", " ", "music_", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"soundNoteList", "[", "list_", "]"}], ":=", " ", 
     RowBox[{"Apply", "[", 
      RowBox[{"SoundNote", ",", " ", "list"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"generated", " ", "=", " ", 
     RowBox[{"Map", "[", 
      RowBox[{"soundNoteList", ",", " ", "music"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"sound", " ", "=", " ", 
     RowBox[{"Sound", "[", "generated", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", "sound", "]"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}], "\n", 
 RowBox[{
  RowBox[{"ApplyAndJoin", "[", 
   RowBox[{"fn_", ",", " ", "count_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Map", "[", 
     RowBox[{"fn", ",", " ", 
      RowBox[{"Range", "[", "count", "]"}]}], "]"}], "]"}], 
   "\[IndentingNewLine]", ")"}]}], "\n", 
 RowBox[{
  RowBox[{"ChooseTone", "[", 
   RowBox[{
   "previous_", ",", "weights_", ",", "toneWeights_", ",", " ", 
    "toneImportance_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"allTones", "=", 
     RowBox[{"Range", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Length", "[", "weights", "]"}]}], "+", "1", " ", "+", " ", 
        "previous"}], ",", 
       RowBox[{
        RowBox[{"Length", "[", "weights", "]"}], "-", "1", "+", 
        "previous"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"allIntervalWeights", "=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"Reverse", "[", 
        RowBox[{"Drop", "[", 
         RowBox[{"weights", ",", "1"}], "]"}], "]"}], ",", "weights"}], 
      "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"allToneWeights", "=", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{"Function", "[", 
        RowBox[{"t", ",", 
         RowBox[{"Part", "[", 
          RowBox[{"toneWeights", ",", 
           RowBox[{
            RowBox[{"Mod", "[", 
             RowBox[{"t", ",", " ", 
              RowBox[{"Length", "[", "toneWeights", "]"}]}], "]"}], " ", "+", 
            " ", "1"}]}], "]"}]}], "]"}], ",", "allTones"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"totalWeights", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"allToneWeights", " ", "*", " ", "allIntervalWeights"}], ")"}],
       " ", "^", " ", "toneImportance"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"tone", " ", "=", " ", 
     RowBox[{"Part", "[", 
      RowBox[{
       RowBox[{"RandomSample", "[", 
        RowBox[{
         RowBox[{"totalWeights", " ", "\[Rule]", " ", "allTones"}], ",", " ", 
         "1"}], "]"}], ",", " ", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", "tone", "]"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}], "\n", 
 RowBox[{
  RowBox[{"GetMelody", "[", 
   RowBox[{"rythm_", ",", " ", "weights_", ",", " ", "toneWeights_"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"melody", " ", "=", " ", 
     RowBox[{"{", "0", "}"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"For", "[", 
     RowBox[{
      RowBox[{"i", "=", "1"}], ",", " ", 
      RowBox[{"i", "<", 
       RowBox[{"Length", "[", "rythm", "]"}]}], ",", 
      RowBox[{"i", "++"}], ",", " ", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"previous", " ", "=", " ", 
         RowBox[{"Part", "[", 
          RowBox[{"melody", ",", " ", "i"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"next", " ", "=", " ", 
         RowBox[{"ChooseTone", "[", 
          RowBox[{
          "previous", ",", " ", "weights", ",", " ", "toneWeights", ",", " ", 
           
           RowBox[{
            RowBox[{"Part", "[", 
             RowBox[{"rythm", ",", " ", "i"}], "]"}], " ", "+", " ", "1"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"melody", ",", " ", "next"}], "]"}], ";"}], 
       "\[IndentingNewLine]", ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", "melody", "]"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}], "\n", 
 RowBox[{
  RowBox[{"CreateMusic", "[", 
   RowBox[{"melody_", ",", " ", "tones_", ",", " ", "rythm_"}], "]"}], " ", ":=",
   " ", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"music", " ", "=", " ", 
     RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"For", "[", 
     RowBox[{
      RowBox[{"i", "=", "0"}], ",", " ", 
      RowBox[{"i", "<", 
       RowBox[{"Length", "[", "melody", "]"}]}], ",", 
      RowBox[{"i", "++"}], ",", " ", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"toneOffset", " ", "=", " ", 
         RowBox[{"Part", "[", 
          RowBox[{"melody", ",", " ", 
           RowBox[{"i", "+", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tone", " ", "=", " ", 
         RowBox[{
          RowBox[{"Part", "[", 
           RowBox[{"tones", ",", " ", 
            RowBox[{"1", " ", "+", " ", 
             RowBox[{"Mod", "[", 
              RowBox[{"toneOffset", ",", " ", 
               RowBox[{"Length", "[", "tones", "]"}]}], "]"}]}]}], "]"}], " ",
           "+", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Floor", "[", 
             RowBox[{"toneOffset", " ", "/", " ", 
              RowBox[{"Length", "[", "tones", "]"}]}], "]"}], " ", "*", " ", 
            "12"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sound", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{"tone", ",", " ", 
           RowBox[{
            RowBox[{"Part", "[", 
             RowBox[{"rythm", ",", " ", 
              RowBox[{"i", " ", "+", " ", "1"}]}], "]"}], " ", "*", " ", 
            "1.5"}], ",", " ", "\"\<Piano\>\""}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"music", ",", "sound"}], "]"}], ";"}], "\[IndentingNewLine]",
        ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Return", "[", "music", "]"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GetTact", "[", 
    RowBox[{"divCoef_", ",", " ", "recursionCoef_"}], "]"}], " ", ":=", " ", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"RandomReal", "[", "]"}], " ", ">", " ", "divCoef"}], ",", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", "1", "}"}], "]"}], "\[IndentingNewLine]", ")"}], ",", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"divLen", "[", "e_", "]"}], " ", ":=", " ", 
         RowBox[{"e", " ", "/", " ", "2"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", " ", 
         RowBox[{"Map", "[", 
          RowBox[{"divLen", ",", " ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"GetTact", "[", 
              RowBox[{
               RowBox[{"divCoef", " ", "/", " ", "recursionCoef"}], ",", " ", 
               "recursionCoef"}], "]"}], ",", " ", 
             RowBox[{"GetTact", "[", 
              RowBox[{
               RowBox[{"divCoef", "/", "recursionCoef"}], ",", " ", 
               "recursionCoef"}], "]"}]}], "]"}]}], "]"}], "]"}], ";"}], 
       "\[IndentingNewLine]", ")"}]}], "]"}], "\[IndentingNewLine]", ")"}]}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GetRythm", "[", 
    RowBox[{"divCoef_", ",", " ", "recursionCoef_", ",", " ", "size_"}], 
    "]"}], " ", ":=", " ", "\[IndentingNewLine]", 
   RowBox[{"ApplyAndJoin", "[", 
    RowBox[{
     RowBox[{"Function", "[", 
      RowBox[{"i", ",", " ", 
       RowBox[{"GetTact", "[", 
        RowBox[{"divCoef", ",", " ", "recursionCoef"}], "]"}]}], "]"}], ",", 
     " ", "size"}], "]"}]}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"rtm1", " ", "=", " ", 
   RowBox[{"GetRythm", "[", 
    RowBox[{"2.3", ",", " ", "3", ",", "  ", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rtm2", " ", "=", " ", 
   RowBox[{"GetRythm", "[", 
    RowBox[{"2.1", ",", " ", "2", ",", "  ", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tones", " ", "=", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0", ",", " ", "2", ",", "3", ",", " ", "5", ",", " ", "7", ",", " ", 
      "8", ",", " ", "10"}], "}"}], " ", "+", " ", "0"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"weights", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "1", ",", " ", "5", ",", " ", "5", ",", " ", "3", ",", " ", "3", ",", " ",
      "0.7", ",", "0.7", ",", " ", "1.2", ",", " ", "1"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"toneWeights", "=", 
   RowBox[{"{", 
    RowBox[{
    "1.7", ",", " ", "1.5", ",", " ", "1.6", ",", " ", "1", ",", " ", "1.6", 
     ",", " ", "1.5", ",", " ", "1"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CmpM", "[", "rtm_", "]"}], ":=", 
   RowBox[{"GetMelody", "[", 
    RowBox[{"rtm", ",", " ", "weights", ",", " ", "toneWeights"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mainM", " ", "=", " ", 
   RowBox[{"CmpM", "[", "rtm2", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"melody1", " ", "=", " ", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"CmpM", "[", "rtm1", "]"}], ",", " ", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{"mainM", ",", " ", 
       RowBox[{
        RowBox[{"Length", "[", "rtm2", "]"}], "\[Rule]", " ", "4"}]}], "]"}], 
     ",", " ", 
     RowBox[{"CmpM", "[", "rtm1", "]"}], ",", " ", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{"mainM", ",", " ", 
       RowBox[{
        RowBox[{"Length", "[", "rtm2", "]"}], "\[Rule]", "0"}]}], "]"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mainM", " ", "=", " ", 
   RowBox[{"CmpM", "[", "rtm1", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"melody2", " ", "=", " ", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"CmpM", "[", "rtm2", "]"}], ",", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"mainM", ",", " ", 
        RowBox[{
         RowBox[{"Length", "[", "rtm1", "]"}], "\[Rule]", " ", "4"}]}], "]"}],
       ",", " ", 
      RowBox[{"CmpM", "[", "rtm2", "]"}], ",", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"mainM", ",", " ", 
        RowBox[{
         RowBox[{"Length", "[", "rtm1", "]"}], "\[Rule]", "0"}]}], "]"}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"genSound", "[", 
  RowBox[{"CreateMusic", "[", 
   RowBox[{
    RowBox[{"Join", "[", 
     RowBox[{"melody1", ",", " ", "melody2", ",", " ", 
      RowBox[{"melody1", "+", "3"}], ",", " ", 
      RowBox[{"melody2", "-", "4"}]}], "]"}], ",", "tones", ",", 
    RowBox[{"ApplyAndJoin", "[", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{"i", ",", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
         "rtm1", ",", " ", "rtm2", ",", " ", "rtm1", ",", " ", "rtm2", ",", 
          " ", "rtm2", ",", " ", "rtm1", ",", " ", "rtm2", ",", " ", "rtm1"}],
          "]"}]}], "]"}], ",", " ", "2"}], "]"}]}], "]"}], 
  "]"}], "\n"}], "Input",
 CellChangeTimes->{{3.684046514851108*^9, 3.684046519931779*^9}, {
  3.684046645958846*^9, 3.684046672678063*^9}, {3.684046708974457*^9, 
  3.684046843623981*^9}, {3.6840470143046303`*^9, 3.684047029467244*^9}, {
  3.6840473015291653`*^9, 3.684047373231291*^9}, {3.6840475550018463`*^9, 
  3.684047560456291*^9}, {3.684047646591329*^9, 3.684047659678829*^9}, {
  3.684047755748856*^9, 3.684047777445161*^9}, {3.6840478666902523`*^9, 
  3.684047870069398*^9}, {3.6840479534641743`*^9, 3.6840479920608387`*^9}, {
  3.684048311510783*^9, 3.684048369940363*^9}, {3.684048448697501*^9, 
  3.684048503995116*^9}, {3.684048560206251*^9, 3.6840485675304003`*^9}, {
  3.684050369276421*^9, 3.684050371070743*^9}, {3.685632775602785*^9, 
  3.685632777170759*^9}, {3.6857215539187*^9, 3.68572157206695*^9}}]
},
WindowSize->{1301, 744},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.0 for Linux x86 (64-bit) (July 28, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 12215, 309, 1418, "Input"]
}
]
*)

